import{d as w,a8 as T,f as d,o as C,ae as y,g as i,h as r,i as o,k as u,q as x,n as c,D as M,F as _,m as b,aU as I,l as E,j as L,t as f,ab as N,_ as S}from"./CXHDnMyn.js";const $=window.setInterval,D={class:"widget-card comments-container"},A={key:0,class:"loading"},F={key:1,class:"error"},B={key:2,class:"comments-list"},O=["onClick"],R={class:"comment-meta"},j={class:"author-info"},z=["src","alt"],U={class:"author"},V={class:"date"},H=["innerHTML"],P="https://twikoo-blog-v3.314926.xyz",q="b624bd863eaf16b3eef5efc9ce6086e7",G=w({__name:"LatestComments",setup(W){const s=T("latestComments",()=>({comments:[],loading:!0,error:!1,lastFetchTime:0})),v=d(()=>s.value.comments),h=d(()=>s.value.loading),p=d(()=>s.value.error);function g(a){const n=[{max:60,text:"刚刚"},{max:3600,div:60,unit:"分钟前"},{max:86400,div:3600,unit:"小时前"},{max:604800,div:86400,unit:"天前"}],e=Math.floor((Date.now()-a)/1e3),t=n.find(l=>e<l.max);return t?t.div!==void 0?`${Math.floor(e/t.div)}${t.unit}`:t.text:`${new Intl.DateTimeFormat("zh-CN",{month:"numeric",day:"numeric"}).format(a)}日`}function k(a){return a?Object.entries({"<pre><code>[\\s\\S]*?</code></pre>":"[代码块]","<code>([^<]{4,})</code>":"[代码]","<code>([^<]{1,3})</code>":"$1",'<img(?![^>]*class="tk-owo-emotion")[^>]*>':"[图片]","<a[^>]*?>[\\s\\S]*?</a>":"[链接]",'<(?!img[^>]*class="tk-owo-emotion")[^>]+>':""}).reduce((e,[t,l])=>e.replace(new RegExp(t,"g"),l),a).trim():""}async function m(){const a=Date.now();if(!(a-s.value.lastFetchTime<600*1e3))try{s.value.loading=!0,s.value.error=!1;const n=await $fetch(P,{method:"POST",body:{event:"GET_RECENT_COMMENTS",includeReply:!0,pageSize:10},timeout:5e3});if(!n?.data)throw new Error("No data");s.value.comments=n.data.filter(e=>e.url!=="/").slice(0,5).map(e=>({content:k(e.comment),author:e.nick,date:g(e.created),avatar:e.avatar,isAdmin:e.mailMd5===q,url:e.url,id:e.id})),s.value.lastFetchTime=a}catch{s.value.error=!0}finally{s.value.loading=!1}}return C(()=>{m();const a=$(m,600*1e3);y(()=>clearInterval(a))}),(a,n)=>{const e=M;return r(),i(_,null,[n[2]||(n[2]=o("h3",{class:"widget-title"}," 最新评论 ",-1)),o("div",D,[u(N,{name:"fade",mode:"out-in"},{default:x(()=>[c(h)?(r(),i("div",A,[...n[0]||(n[0]=[o("div",{class:"loading-spinner"},null,-1),o("p",null,"加载中...",-1)])])):c(p)?(r(),i("div",F,[u(e,{name:"line-md:alert",class:"error-icon"}),n[1]||(n[1]=o("span",null,"评论加载失败",-1))])):(r(),i("ul",B,[(r(!0),i(_,null,b(c(v),t=>(r(),i("li",{key:t.id,class:"comment-item",onClick:l=>("navigateTo"in a?a.navigateTo:c(I))(`${t.url}#${t.id}`)},[o("div",R,[o("div",j,[o("img",{src:t.avatar,alt:t.author,class:"avatar"},null,8,z),o("span",U,f(t.author),1),t.isAdmin?(r(),E(e,{key:0,name:"ph:seal-check-fill",class:"admin-badge"})):L("",!0)]),o("time",V,f(t.date),1)]),o("p",{class:"comment-content",title:"点击查看完整评论",innerHTML:t.content},null,8,H)],8,O))),128))]))]),_:1})])],64)}}}),K=Object.assign(S(G,[["__scopeId","data-v-4541bd19"]]),{__name:"WidgetLatestComments"});export{K as default};
